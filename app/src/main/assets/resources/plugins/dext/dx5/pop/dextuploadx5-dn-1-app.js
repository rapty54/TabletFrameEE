var svgh=new SVGHelper;var MAX_SPEED_SLOT=15;var MAX_SPEED_BAR=8.5;var speeds=[];var stime=null;var active=false;var hostId="";var setLang=false;var root=null;var main=null;var pgrcursize=null;var pgrtotsize=null;var speedValue=null;var speedUnit=null;var txtAt=null;var txtFilename=null;var txtCurSize=null;var txtTotSize=null;var txtCurTime=null;var txtTotTime=null;var txtCount=null;var winfo=null;var titSize=null;var titTime=null;var titCount=null;var titlCancel=null;var twait=null;function updateUILayout(){var s=root.getComputedSize();if(s.w>0||s.h>0){main.updateLayout(s.w,s.h)}}function updateCurSizeRate(size,current){var rate=size===0?0:current/size,r=64,seta=rate>0?360*rate:0,x=0,y=0,d="";if(rate>.5){seta=seta-180;x=r*Math.sin(getRadians(seta));y=r-r*Math.cos(getRadians(seta));d="M125,168 a64,64 0 0,1 -0,-128 a64,64 0 0,1 "+x+","+y}else{x=r*Math.sin(getRadians(seta));y=r-r*Math.cos(getRadians(seta));d="M125,168 a64,64 0 0,1 "+-x+","+-y}pgrcursize.att("d",d)}function updateTotSizeRate(size,current){var rate=size===0?0:current/size,r=70,seta=rate>0?360*rate:0,x=0,y=0,d="";if(rate>.5){seta=seta-180;x=r*Math.sin(getRadians(seta));y=r-r*Math.cos(getRadians(seta));d="M125,174 a70,70 0 0,1 -0,-140 a70,70 0 0,1 "+x+","+y}else{x=r*Math.sin(getRadians(seta));y=r-r*Math.cos(getRadians(seta));d="M125,174 a70,70 0 0,1 "+-x+","+-y}pgrtotsize.att("d",d)}function updateSpeedSlot(s){if(stime){var ntime=new Date;if(ntime-stime>250){stime=ntime}else{return}}else{stime=new Date}if(speeds.length==MAX_SPEED_SLOT)speeds.shift();if(s<1&&s>0)s=1;speeds.push(s);var i=0,len=0,min=0,max=0;for(i=0,len=speeds.length;i<len;i++){if(min==0)min=speeds[i];if(max==0)max=speeds[i];if(speeds[i]<min)min=speeds[i];if(speeds[i]>max)max=speeds[i]}var rd=0,rel=0,bar=null;for(i=0,rd=Math.abs(max-min),len=speeds.length;i<len;i++){rel=MAX_SPEED_BAR*(rd==0?1:Math.abs(speeds[i]-min)/rd);bar=svgh.getAsUnit("UIC-SPEED-BAR-"+i);bar.att("d","M"+(.5+2*i)+",8.5 v"+-rel)}}function progress(t){var status=t.getDownloadStatus();updateCurSizeRate(status.currentSize,status.currentReceiveSize);updateTotSizeRate(status.totalSize,status.totalReceiveSize);updateSpeedSlot(status.totalRate<100?status.currentSpeed:0);var strSpeed=getFriendlySpeed(status.totalRate<100?status.currentSpeed:0,2);var tokenSpeed=strSpeed.split(" ");if(status.totalRate<=100){winfo.css("display","none");speedValue.replaceText(tokenSpeed[0]);speedUnit.replaceText(tokenSpeed[1]);txtAt.replaceText(status.currentName);txtFilename.replaceText(status.currentName);txtCurSize.replaceText(getFriendlySize(status.currentReceiveSize)+" ( "+getFriendlySize(status.currentSize)+" )");txtTotSize.replaceText(getFriendlySize(status.totalReceiveSize)+" ( "+getFriendlySize(status.totalSize)+" )");txtCurTime.replaceText(msecToTimeFormat(status.currentTime)+" / "+msecToTimeFormat(status.remainedCurrentTime));txtTotTime.replaceText(msecToTimeFormat(status.totalTime)+" / "+msecToTimeFormat(status.remainedTotalTime));txtCount.replaceText(status.completeCount+" / "+status.totalCount)}if(status.totalRate>=100){setTimeout(function(){winfo.css("display","block");speedValue.replaceText(tokenSpeed[0]);speedUnit.replaceText(tokenSpeed[1]);txtAt.replaceText("");txtFilename.replaceText("");txtCurSize.replaceText(getFriendlySize(status.currentReceiveSize)+" ( "+getFriendlySize(status.currentSize)+" )");txtTotSize.replaceText(getFriendlySize(status.totalReceiveSize)+" ( "+getFriendlySize(status.totalSize)+" )");txtCurTime.replaceText(msecToTimeFormat(status.currentTime)+" / "+msecToTimeFormat(status.remainedCurrentTime));txtTotTime.replaceText(msecToTimeFormat(status.totalTime)+" / "+msecToTimeFormat(status.remainedTotalTime));txtCount.replaceText(status.completeCount+" / "+status.totalCount);active=false},100)}else if(active&&status.totalRate<100){setTimeout(function(){progress(t)},100)}}document["stopUI"]=function(lazy){if(lazy){return!active}else{active=false;return true}};document["updateUI"]=function(t){if(!setLang){var rb=t.getResourceBundle();titSize.replaceText(rb.get("RB-POPDN-1-0001","_다운로드 크기"));titTime.replaceText(rb.get("RB-POPDN-1-0002","_진행 시간"));titCount.replaceText(rb.get("RB-POPDN-1-0003","_처리된 파일"));titlCancel.replaceText(rb.get("RB-POPDN-1-0004","_중지"));twait.replaceText(rb.get("RB-POPDN-1-0005","_마무리 작업을 대기하고 있습니다."));setLang=true}updateUILayout();speeds=[];stime=null;active=true;hostId=t.domObject.id;progress(t)};function onLoadHandler(_evt){root=svgh.getAsUnit("UIC-DEXTUPLOADX5-PROGRESSIVE");main=svgh.getAsUnit("UIC-MAIN-AREA");pgrcursize=svgh.getAsUnit("UIC-PROGRESSIVE-CUR-SIZE");pgrtotsize=svgh.getAsUnit("UIC-PROGRESSIVE-TOT-SIZE");speedValue=svgh.getAsUnit("UIC-PROGRESSIVE-SPEED-VALUE");speedUnit=svgh.getAsUnit("UIC-PROGRESSIVE-SPEED-UNIT");txtAt=svgh.getAsUnit("UIC-AT-FILENAME");txtFilename=svgh.getAsUnit("UIC-TXT-FILENAME");txtCurSize=svgh.getAsUnit("UIC-TXT-CURRENT-SIZE");txtTotSize=svgh.getAsUnit("UIC-TXT-TOTAL-SIZE");txtCurTime=svgh.getAsUnit("UIC-TXT-CURRENT-TIME-VALUE");txtTotTime=svgh.getAsUnit("UIC-TXT-TOTAL-TIME-VALUE");txtCount=svgh.getAsUnit("UIC-TXT-COUNT-VALUE");winfo=svgh.getAsUnit("UIC-WAIT-INFO");titSize=svgh.getAsUnit("UIC-TITLE-SIZE");titTime=svgh.getAsUnit("UIC-TITLE-TIME");titCount=svgh.getAsUnit("UIC-TITLE-COUNT");titlCancel=svgh.getAsUnit("UIC-TITLE-CANCEL");twait=svgh.getAsUnit("UIC-TXT-WAIT");svgh.getAsUnit("UIC-BTN-CANCEL").bind("click",function(evt){evt.stopPropagation();evt.preventDefault();active=false;if(window.parent.dx5){window.parent.dx5.hideDownloadProgress(hostId,true);hostId=""}},false);updateUILayout();console.log("DX5: dextuploadx5-dn-1 loaded")}